<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YouTube</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f0f0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="YouTube">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Preconnect: YouTube/Google domains (DNS+TLS handshake early) -->
    <link rel="preconnect" href="https://www.youtube.com">
    <link rel="preconnect" href="https://www.googleapis.com">
    <link rel="preconnect" href="https://i.ytimg.com">
    <link rel="dns-prefetch" href="https://www.youtube.com">
    <link rel="dns-prefetch" href="https://www.googleapis.com">
    <link rel="dns-prefetch" href="https://i.ytimg.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">

    <!-- Fonts (preconnect both domains) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" href="assets/icons/icon-192.png" type="image/png">
</head>
<body>
    <!-- Splash / Loading Screen (YouTube style) -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">
                <!-- YouTube Logo -->
                <svg class="yt-logo-splash" viewBox="0 0 380 86" preserveAspectRatio="xMidYMid meet">
                    <!-- Red play button -->
                    <path d="M63.2 2.4C60.7.6 57.8 0 54.6 0H31.4C14.1 0 0 14.1 0 31.4v23.2C0 71.9 14.1 86 31.4 86h23.2C71.9 86 86 71.9 86 54.6V31.4C86 18.9 78 8.4 67 3.7c-1.3-.5-2.5-1-3.8-1.3zM35.5 60.5V25.5L62 43z" fill="#FF0000"/>
                    <!-- "YouTube" text -->
                    <text x="100" y="60" font-family="Roboto, Arial, sans-serif" font-size="52" font-weight="500" fill="white">YouTube</text>
                </svg>
            </div>
            <div class="loader"></div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app hidden">
        <!-- Top Bar with YouTube Shorts logo -->
        <div id="category-bar" class="category-bar">
            <div class="top-bar-inner">
                <!-- Shorts Logo -->
                <div class="shorts-logo">
                    <svg viewBox="0 0 24 24" class="shorts-icon">
                        <path d="M10 14.65v-5.3L15 12l-5 2.65zm7.77-4.33c-.77-.32-1.2-.5-1.2-.5L18 9.06c1.84-.96 2.53-3.23 1.56-5.06s-3.24-2.53-5.07-1.56L6 6.94c-1.29.68-2.07 2.04-2 3.49.07 1.42.93 2.67 2.22 3.25.03.01 1.2.5 1.2.5L6 14.93c-1.83.97-2.53 3.24-1.56 5.07.97 1.83 3.24 2.53 5.07 1.56l8.5-4.5c1.29-.68 2.06-2.04 1.99-3.49-.07-1.42-.94-2.68-2.23-3.25z" fill="#FF0000"/>
                    </svg>
                    <span class="shorts-text">Shorts</span>
                </div>
                <!-- Category chips (built dynamically by app.js) -->
                <div class="category-tabs" id="category-tabs"></div>
            </div>
        </div>

        <!-- Video Feed (vertical scroll) -->
        <div id="video-feed" class="video-feed">
            <!-- Videos are injected here dynamically -->
        </div>

        <!-- Navigation Arrows (desktop) -->
        <button id="nav-up" class="nav-arrow nav-up hidden" aria-label="Previous video">
            <svg viewBox="0 0 24 24" width="24" height="24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="white"/></svg>
        </button>
        <button id="nav-down" class="nav-arrow nav-down" aria-label="Next video">
            <svg viewBox="0 0 24 24" width="24" height="24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z" fill="white"/></svg>
        </button>

        <!-- Right-side action buttons (YouTube Shorts style) -->
        <div class="action-buttons">
            <!-- Like (outlined) -->
            <button class="action-btn" id="like-btn" aria-label="Like">
                <svg viewBox="0 0 24 24" width="28" height="28"><path d="M9 21h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.58 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2zM9 9l4.34-4.34L12 10h9v2l-3 7H9V9zM1 9h4v12H1z" fill="white"/></svg>
                <span class="action-label">Like</span>
            </button>
            <!-- Dislike (outlined, blocks channel internally) -->
            <button class="action-btn" id="dislike-btn" aria-label="Dislike">
                <svg viewBox="0 0 24 24" width="28" height="28"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm0 12l-4.34 4.34L12 14H3v-2l3-7h9v10zm4-12h4v12h-4z" fill="white"/></svg>
                <span class="action-label">Dislike</span>
            </button>
            <!-- Comments (decorative) -->
            <button class="action-btn" id="comment-btn" aria-label="Comments">
                <svg viewBox="0 0 24 24" width="28" height="28"><path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2zm0 15.17L18.83 16H4V4h16v13.17z" fill="white"/></svg>
                <span class="action-label">0</span>
            </button>
            <!-- Share -->
            <button class="action-btn" id="share-btn" aria-label="Share">
                <svg viewBox="0 0 24 24" width="28" height="28"><path d="M15 5.63L20.66 12 15 18.37V15v-1h-1c-3.96 0-7.14 1-9.75 3.09 1.84-4.07 5.11-6.4 9.89-7.1l.86-.13V9V5.63M14 3v6C6.22 10.13 3.11 15.33 2 21c2.78-3.97 6.44-6 12-6v6l8-9L14 3z" fill="white"/></svg>
                <span class="action-label">Share</span>
            </button>
            <!-- Mute toggle -->
            <button id="mute-toggle" class="action-btn" aria-label="Toggle mute">
                <span id="mute-icon">
                    <svg viewBox="0 0 24 24" width="28" height="28"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" fill="white"/></svg>
                </span>
                <span class="action-label">Muted</span>
            </button>
            <!-- Channel avatar disc -->
            <div class="action-avatar" id="channel-avatar">
                <div class="avatar-img"></div>
            </div>
        </div>

        <!-- Video Info Overlay (YouTube Shorts layout) -->
        <div id="video-info" class="video-info">
            <div class="channel-line">
                <div class="channel-avatar-sm"></div>
                <span id="video-channel" class="video-channel"></span>
            </div>
            <h3 id="video-title" class="video-title"></h3>
            <div class="audio-line">
                <svg viewBox="0 0 24 24" width="14" height="14"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55C7.79 13 6 14.79 6 17s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" fill="white"/></svg>
                <span id="audio-name" class="audio-name">Original audio</span>
            </div>
        </div>

        <!-- Settings Button (hidden in corner, parent only) -->
        <button id="settings-btn" class="settings-btn" aria-label="Settings">
            <svg viewBox="0 0 24 24" width="20" height="20"><path d="M12,8c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2S10.9,8,12,8z M12,10c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S13.1,10,12,10z M12,16c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S13.1,16,12,16z" fill="white"/></svg>
        </button>

        <!-- Timer Display -->
        <div id="timer-display" class="timer-display hidden">
            <span id="timer-text">30:00</span>
        </div>

        <!-- Tap to Unmute Overlay (shown on first video, dismissed on tap) -->
        <div id="unmute-overlay" class="unmute-overlay hidden">
            <div class="unmute-pill">
                <svg viewBox="0 0 24 24" width="20" height="20"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" fill="white"/></svg>
                <span>Tap to unmute</span>
            </div>
        </div>

        <!-- Install App Banner -->
        <div id="install-banner" class="install-banner hidden">
            <div class="install-banner-inner">
                <div class="install-banner-icon">
                    <svg viewBox="0 0 24 24" width="36" height="36"><rect width="24" height="24" rx="5" fill="#FF0000"/><polygon points="9.5,6.5 9.5,17.5 18,12" fill="white"/></svg>
                </div>
                <div class="install-banner-text">
                    <strong>YouTube</strong>
                    <span>Install app for the best experience</span>
                </div>
                <button id="install-btn" class="install-banner-btn">Install</button>
                <button id="install-dismiss" class="install-banner-close">&times;</button>
            </div>
        </div>
    </div>

    <!-- PIN Entry Modal -->
    <div id="pin-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content pin-modal-content">
            <h2 id="pin-modal-title">Enter Parent PIN</h2>
            <p id="pin-modal-subtitle">Enter your 4-digit PIN</p>
            <div class="pin-dots">
                <span class="pin-dot" id="dot-0"></span>
                <span class="pin-dot" id="dot-1"></span>
                <span class="pin-dot" id="dot-2"></span>
                <span class="pin-dot" id="dot-3"></span>
            </div>
            <div class="pin-error hidden" id="pin-error">Incorrect PIN. Try again.</div>
            <div class="pin-pad">
                <button class="pin-key" data-key="1">1</button>
                <button class="pin-key" data-key="2">2</button>
                <button class="pin-key" data-key="3">3</button>
                <button class="pin-key" data-key="4">4</button>
                <button class="pin-key" data-key="5">5</button>
                <button class="pin-key" data-key="6">6</button>
                <button class="pin-key" data-key="7">7</button>
                <button class="pin-key" data-key="8">8</button>
                <button class="pin-key" data-key="9">9</button>
                <button class="pin-key pin-key-empty"></button>
                <button class="pin-key" data-key="0">0</button>
                <button class="pin-key pin-key-back" data-key="back">&#9003;</button>
            </div>
            <button class="btn-text" id="pin-cancel-btn">Cancel</button>
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settings-panel" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content settings-content">
            <div class="settings-header">
                <h2>Parent Settings</h2>
                <button id="settings-close-btn" class="close-btn">&times;</button>
            </div>
            <div class="settings-body">
                <!-- How to Use Guide -->
                <div class="setting-group guide-section">
                    <h3>How to Use</h3>
                    <ul class="guide-list">
                        <li>This app plays safe, curated short videos for kids</li>
                        <li>Kids just swipe up/down to watch the next video</li>
                        <li>Tap the <strong>Dislike</strong> button to block a channel you don't like</li>
                        <li>Select <strong>Video Categories</strong> below to control what types of content appear</li>
                        <li>Choose <strong>Languages</strong> to get videos in your preferred languages</li>
                        <li>Set a <strong>Time Limit</strong> to control how long your child can watch</li>
                        <li>Enable <strong>Bedtime</strong> to auto-lock the app at night</li>
                        <li>Tap <strong>Save &amp; Apply</strong> after making changes</li>
                        <li>The 3-dot menu (top-right) opens settings â€” it requires your PIN</li>
                    </ul>
                </div>

                <!-- Video Categories -->
                <div class="setting-group">
                    <h3>Video Categories</h3>
                    <p class="setting-hint">Select which types of videos to show</p>
                    <div class="checkbox-grid" id="category-checkboxes">
                        <label class="checkbox-item"><input type="checkbox" value="indian-kids" checked><span>Kids Videos</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="devotional" checked><span>Devotional</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="good-habits" checked><span>Good Habits</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="kids-arts" checked><span>Arts & Crafts</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="kids-knowledge" checked><span>Knowledge</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="nursery-rhymes"><span>Nursery Rhymes</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="moral-stories"><span>Moral Stories</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="math-learning"><span>Math</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="science-fun"><span>Science</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="yoga-kids"><span>Yoga & Exercise</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="cooking-kids"><span>Cooking</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="animal-facts"><span>Animals</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="space-facts"><span>Space</span></label>
                    </div>
                </div>

                <!-- Languages -->
                <div class="setting-group">
                    <h3>Languages</h3>
                    <p class="setting-hint">Select preferred video languages</p>
                    <div class="checkbox-grid" id="language-checkboxes">
                        <label class="checkbox-item"><input type="checkbox" value="english" checked><span>English</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="hindi" checked><span>Hindi</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="telugu"><span>Telugu</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="tamil"><span>Tamil</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="kannada"><span>Kannada</span></label>
                        <label class="checkbox-item"><input type="checkbox" value="malayalam"><span>Malayalam</span></label>
                    </div>
                </div>

                <!-- Time Limit -->
                <div class="setting-group">
                    <h3>Time Limit</h3>
                    <div class="setting-row">
                        <label for="time-limit-toggle">Enable time limit</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="time-limit-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row" id="time-limit-options">
                        <label for="time-limit-select">Duration</label>
                        <select id="time-limit-select">
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">1 hour</option>
                            <option value="90">1.5 hours</option>
                            <option value="120">2 hours</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="daily-reset-toggle">Reset timer daily</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="daily-reset-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Bedtime -->
                <div class="setting-group">
                    <h3>Bedtime</h3>
                    <div class="setting-row">
                        <label for="bedtime-toggle">Enable bedtime lock</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="bedtime-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row" id="bedtime-options">
                        <label for="bedtime-select">Lock after</label>
                        <select id="bedtime-select">
                            <option value="19">7:00 PM</option>
                            <option value="20">8:00 PM</option>
                            <option value="21" selected>9:00 PM</option>
                            <option value="22">10:00 PM</option>
                        </select>
                    </div>
                </div>

                <!-- Blocked Channels -->
                <div class="setting-group">
                    <h3>Blocked Channels</h3>
                    <p class="setting-hint">Channels blocked via the Dislike button</p>
                    <div id="blocked-channels-list" class="blocked-list">
                        <p class="empty-state">No blocked channels</p>
                    </div>
                </div>

                <!-- Watch History -->
                <div class="setting-group">
                    <h3>Watch History</h3>
                    <p class="setting-hint">Recent videos your child watched</p>
                    <div id="watch-history-list" class="history-list">
                        <p class="empty-state">No watch history yet</p>
                    </div>
                    <button id="clear-history-btn" class="btn-text" style="margin-top:8px">Clear History</button>
                </div>

                <!-- PIN Management -->
                <div class="setting-group">
                    <h3>PIN Settings</h3>
                    <div class="pin-actions">
                        <button id="change-pin-btn" class="btn-secondary">Change PIN</button>
                        <button id="disable-pin-btn" class="btn-secondary">Disable PIN</button>
                        <button id="reset-pin-btn" class="btn-danger">Reset PIN</button>
                    </div>
                    <p class="setting-hint" style="margin-top:8px">Disable PIN removes the lock. Reset PIN deletes it so you can set a new one on next launch.</p>
                </div>

                <!-- Save & Apply -->
                <div class="setting-group">
                    <button id="save-settings-btn" class="btn-primary">Save & Apply</button>
                </div>

                <!-- Reset -->
                <div class="setting-group">
                    <h3>Reset App</h3>
                    <button id="reset-app-btn" class="btn-danger">Reset Everything</button>
                </div>

                <!-- Branding -->
                <div class="setting-group branding-section">
                    <p class="branding-text">Designed by <strong>EPIXS Media</strong>, Tirupati</p>
                    <p class="branding-sub">This app is completely free of cost with no ads.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Time's Up Modal -->
    <div id="times-up-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content times-up-content">
            <div class="times-up-icon">&#9200;</div>
            <h2>Time's Up!</h2>
            <p>Your watching time is over for now.</p>
            <p class="hint">A parent can enter the PIN to extend time.</p>
            <button id="extend-time-btn" class="btn-primary">Enter PIN to Continue</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/videos.js"></script>
    <script src="js/player.js"></script>
    <script src="js/parental.js"></script>
    <script src="js/app.js"></script>

    <!-- Register Service Worker for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(() => console.log('SW registered'))
                .catch((err) => console.log('SW registration failed:', err));
        }

        // PWA Install Prompt
        let deferredPrompt = null;
        const installBanner = document.getElementById('install-banner');
        const installBtn = document.getElementById('install-btn');
        const installDismiss = document.getElementById('install-dismiss');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show install banner after a short delay
            setTimeout(() => {
                if (installBanner) installBanner.classList.remove('hidden');
            }, 3000);
        });

        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const result = await deferredPrompt.userChoice;
                deferredPrompt = null;
                if (installBanner) installBanner.classList.add('hidden');
            });
        }

        if (installDismiss) {
            installDismiss.addEventListener('click', () => {
                if (installBanner) installBanner.classList.add('hidden');
                deferredPrompt = null;
            });
        }

        // Hide banner if app is already installed
        window.addEventListener('appinstalled', () => {
            if (installBanner) installBanner.classList.add('hidden');
            deferredPrompt = null;
        });
    </script>

    <!-- Google Analytics (GA4) - loaded last, non-blocking -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R86WJBJ5EZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-R86WJBJ5EZ');
    </script>
</body>
</html>
